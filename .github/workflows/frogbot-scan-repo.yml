name: ðŸ¸ Frogbot â€“ Full Repo Scan

on:
  workflow_dispatch:
  schedule:
    - cron: "0 8 * * *"   # daily 08:00 UTC (adjust as needed)

permissions:
  contents: read
  security-events: write   # optional: publish to code scanning

jobs:
  scan-repository:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      # No OIDC setup step here
      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      # Install Poetry and ensure it's on PATH
      - name: Install Poetry
        run: |
          python -m pip install --upgrade pip
          python -m pip install --user poetry
          echo "$HOME/.local/bin" >> $GITHUB_PATH

      - name: Run Frogbot (full repo scan)
        uses: jfrog/frogbot@v2
        env:
          # JFrog connection (token auth)
          JF_URL:           ${{ vars.JF_URL }}            # e.g., https://<your>.jfrog.io
          JF_ACCESS_TOKEN:  ${{ secrets.JF_ACCESS_TOKEN }}   # preferred over user/password
          # or instead of token:
          # JF_USER:        ${{ secrets.JF_USER }}
          # JF_PASSWORD:    ${{ secrets.JF_PASSWORD }}

          # GitHub token (for PR comments / API calls in this repo)
          JF_GIT_TOKEN:     ${{ secrets.GITHUB_TOKEN }}

          JF_PATH_EXCLUSIONS: "tools/cot_dt2c,tools/memory,contrib/libtl/tlc"
          JF_ALLOW_PARTIAL_RESULTS: "true"

          JF_ENABLE_GITHUB_CODE_SCANNING: "true"

          # Optional knobs:
          # JF_PROJECT:       ${{ secrets.JF_PROJECT }}
          # JF_MIN_SEVERITY:  "Medium"
          # JF_FAIL:          "TRUE"
          # JF_WORKING_DIR:   "."
          # JF_PATH_EXCLUSIONS: "docs/**,**/*.md"
