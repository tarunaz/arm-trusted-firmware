name: üê∏ Frogbot ‚Äì Full Repo Scan (OIDC)

on:
  workflow_dispatch:             # manual run
  schedule:
    # 08:00 UTC ‚âà 00:00 PT ‚Äî adjust as you like
    - cron: "0 8 * * *"

permissions:
  contents: read
  id-token: write                # REQUIRED for OIDC
  security-events: write         # optional: publish results to code scanning

jobs:
  scan-repository:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      # Set up JFrog CLI with OIDC (recommended by JFrog)
      - name: Setup JFrog CLI (OIDC)
        uses: jfrog/setup-jfrog-cli@v4
        with:
          oidc-provider-name: frogbot-github-oidc   # <-- EXACT provider name from JFrog
        env:
          JF_URL: ${{ vars.JF_URL }}

      # Run Frogbot in "scan repository" mode
      - name: Run Frogbot (full repo scan)
        uses: jfrog/frogbot@v2
        with:
          oidc-provider-name: frogbot-github-oidc
        env:
          # JFrog connection (OIDC handles auth)
          JF_URL: ${{ vars.JF_URL }}

          # Git token (used by Frogbot to interact with GitHub)
          JF_GIT_TOKEN: ${{ secrets.JF_GIT_TOKEN }}

          # Optional tuning:
          # JF_PROJECT:        ${{ vars.JF_PROJECT }}
          # JF_MIN_SEVERITY:   "Medium"     # Low|Medium|High|Critical
          # JF_FAIL:           "TRUE"       # fail the job on findings
          # JF_WORKING_DIR:    "."          # scan a subfolder if needed
          # JF_PATH_EXCLUSIONS: "docs/**,**/*.md"
